import React, { useState, useEffect } from 'react';
import { Heart, Droplets, Scale, UtensilsCrossed, Smile, Flower2, Pill, Sparkles, Calendar, Trophy, Gift, Star, TrendingDown, Target, Award, BookOpen, Bell } from 'lucide-react';

const PostPregnancyApp = () => {
  const [currentWeight, setCurrentWeight] = useState(98);
  const [targetWeight] = useState(78);
  const [waterIntake, setWaterIntake] = useState(0);
  const [waterTarget] = useState(2000);
  const [currentTab, setCurrentTab] = useState('dashboard');
  const [completedTasks, setCompletedTasks] = useState({});
  const [points, setPoints] = useState(0);
  const [moodMorning, setMoodMorning] = useState(null);
  const [moodEvening, setMoodEvening] = useState(null);
  const [journal, setJournal] = useState('');
  const [selectedRecipe, setSelectedRecipe] = useState(null);
  const [selectedExercise, setSelectedExercise] = useState(null);

  const weightLost = 98 - currentWeight;
  const weightToLose = currentWeight - targetWeight;
  const progressPercentage = (weightLost / 20) * 100;

  const todayTip = "üí° Buvez un grand verre d'eau au r√©veil pour r√©hydrater votre corps et booster votre m√©tabolisme";
  const todayMotivation = "üå∏ Chaque petit pas compte. Vous √™tes plus forte que vous ne le pensez !";

  const menus = {
    "petit-dejeuner": [
      {
        name: "Porridge d'avoine aux fruits rouges et graines de chia",
        recipe: "Ingr√©dients:\n‚Ä¢ 60g flocons d'avoine\n‚Ä¢ 250ml lait d'amande\n‚Ä¢ 1 c.√†.s graines de chia\n‚Ä¢ 100g fruits rouges\n‚Ä¢ 1 c.√†.c miel\n\nPr√©paration:\n1. Faire chauffer le lait d'amande\n2. Ajouter les flocons d'avoine, cuire 5 min\n3. Incorporer les graines de chia\n4. Servir avec les fruits rouges et le miel"
      },
      {
        name: "Yaourt grec, granola maison et kiwi",
        recipe: "Ingr√©dients:\n‚Ä¢ 150g yaourt grec 0%\n‚Ä¢ 30g granola maison\n‚Ä¢ 1 kiwi\n‚Ä¢ 1 c.√†.c miel\n‚Ä¢ Quelques amandes\n\nPr√©paration:\n1. √âplucher et couper le kiwi\n2. Dans un bol, mettre le yaourt\n3. Ajouter le granola et le kiwi\n4. Parsemer d'amandes et de miel"
      },
      {
        name: "Smoothie vert (√©pinards, banane, pomme, lait d'amande)",
        recipe: "Ingr√©dients:\n‚Ä¢ 1 poign√©e d'√©pinards frais\n‚Ä¢ 1 banane\n‚Ä¢ 1 pomme verte\n‚Ä¢ 200ml lait d'amande\n‚Ä¢ 1 c.√†.c spiruline (optionnel)\n\nPr√©paration:\n1. Laver les √©pinards\n2. √âplucher la banane et la pomme\n3. Mixer tous les ingr√©dients\n4. Servir frais"
      }
    ],
    "dejeuner": [
      {
        name: "Salade de quinoa aux l√©gumes grill√©s et avocat",
        recipe: "Ingr√©dients:\n‚Ä¢ 80g quinoa\n‚Ä¢ 1 courgette\n‚Ä¢ 1 poivron rouge\n‚Ä¢ 1/2 avocat\n‚Ä¢ Roquette\n‚Ä¢ Huile d'olive, citron\n\nPr√©paration:\n1. Cuire le quinoa 15 min\n2. Griller les l√©gumes √† la po√™le\n3. M√©langer quinoa, l√©gumes, avocat\n4. Assaisonner d'huile d'olive et citron"
      },
      {
        name: "Soupe de lentilles corail au lait de coco",
        recipe: "Ingr√©dients:\n‚Ä¢ 100g lentilles corail\n‚Ä¢ 200ml lait de coco\n‚Ä¢ 1 oignon\n‚Ä¢ 2 carottes\n‚Ä¢ √âpices (cumin, coriandre)\n\nPr√©paration:\n1. Faire revenir l'oignon\n2. Ajouter carottes et lentilles\n3. Verser le lait de coco et 300ml d'eau\n4. Cuire 20 min avec les √©pices"
      },
      {
        name: "Bowl de saumon, riz complet et l√©gumes vapeur",
        recipe: "Ingr√©dients:\n‚Ä¢ 120g saumon\n‚Ä¢ 60g riz complet\n‚Ä¢ Brocolis, carottes\n‚Ä¢ Sauce soja, gingembre\n\nPr√©paration:\n1. Cuire le riz complet\n2. Cuire le saumon √† la vapeur\n3. Faire cuire les l√©gumes √† la vapeur\n4. Dresser en bowl avec la sauce"
      }
    ],
    "diner": [
      {
        name: "Poisson blanc grill√© aux l√©gumes de saison",
        recipe: "Ingr√©dients:\n‚Ä¢ 120g cabillaud\n‚Ä¢ L√©gumes de saison\n‚Ä¢ Herbes de Provence\n‚Ä¢ Huile d'olive\n‚Ä¢ Citron\n\nPr√©paration:\n1. Assaisonner le poisson\n2. Griller √† la po√™le 4 min de chaque c√¥t√©\n3. Cuire les l√©gumes √† la vapeur\n4. Servir avec un filet de citron"
      },
      {
        name: "Omelette aux l√©gumes et salade verte",
        recipe: "Ingr√©dients:\n‚Ä¢ 2 ≈ìufs\n‚Ä¢ Courgette, tomates cerises\n‚Ä¢ Salade verte\n‚Ä¢ Fines herbes\n‚Ä¢ Huile d'olive\n\nPr√©paration:\n1. Faire revenir les l√©gumes\n2. Battre les ≈ìufs avec les herbes\n3. Verser sur les l√©gumes, cuire l'omelette\n4. Servir avec la salade"
      },
      {
        name: "Curry de l√©gumes au lait de coco et riz basmati",
        recipe: "Ingr√©dients:\n‚Ä¢ L√©gumes vari√©s\n‚Ä¢ 200ml lait de coco\n‚Ä¢ 60g riz basmati\n‚Ä¢ P√¢te de curry\n‚Ä¢ Coriandre fra√Æche\n\nPr√©paration:\n1. Faire revenir les l√©gumes\n2. Ajouter la p√¢te de curry\n3. Verser le lait de coco, mijoter 15 min\n4. Servir sur le riz avec la coriandre"
      }
    ]
  };

  const yinYangExercises = [
    {
      name: "Respiration profonde - 5 minutes",
      instructions: "Position: Assise confortablement, dos droit\n\n1. Inspirez lentement par le nez en gonflant le ventre (4 temps)\n2. Retenez votre souffle (4 temps)\n3. Expirez doucement par la bouche (6 temps)\n4. R√©p√©tez pendant 5 minutes\n\nBienfaits: R√©duit le stress, calme le syst√®me nerveux"
    },
    {
      name: "√âtirements doux du cou et des √©paules",
      instructions: "Position: Assise ou debout\n\n1. Inclinez doucement la t√™te vers la droite (30 sec)\n2. R√©p√©tez vers la gauche\n3. Roulez les √©paules vers l'arri√®re (10 fois)\n4. √âtirez les bras vers le ciel puis d√©tendez\n\nBienfaits: Rel√¢che les tensions, am√©liore la posture"
    },
    {
      name: "Posture de l'enfant - 3 minutes",
      instructions: "Position: √Ä genoux sur le sol\n\n1. √âcartez l√©g√®rement les genoux\n2. Asseyez-vous sur vos talons\n3. Penchez-vous vers l'avant, front au sol\n4. √âtendez les bras devant vous ou le long du corps\n5. Respirez profond√©ment\n\nBienfaits: √âtire le dos, calme l'esprit"
    },
    {
      name: "Torsions douces allong√©es",
      instructions: "Position: Allong√©e sur le dos\n\n1. Pliez les genoux vers la poitrine\n2. Laissez tomber les genoux vers la droite\n3. Gardez les √©paules au sol\n4. Restez 1 minute, changez de c√¥t√©\n\nBienfaits: Masse les organes internes, d√©tend le dos"
    }
  ];

  const faceYogaExercises = [
    {
      name: "Massage des tempes en cercles",
      instructions: "Position: Assise confortablement\n\n1. Placez vos index sur vos tempes\n2. Effectuez de petits cercles dans le sens horaire (30 sec)\n3. Puis dans le sens antihoraire (30 sec)\n4. Appliquez une pression douce et constante\n\nBienfaits: R√©duit les tensions, stimule la circulation"
    },
    {
      name: "√âtirements du sourire (sourire large 10 sec)",
      instructions: "Position: Face au miroir\n\n1. Souriez le plus largement possible\n2. Maintenez 10 secondes\n3. D√©tendez 5 secondes\n4. R√©p√©tez 5 fois\n5. Terminez par des petits tapotements sur les joues\n\nBienfaits: Tonifie les muscles des joues, pr√©vient l'affaissement"
    },
    {
      name: "Massage du contour des yeux",
      instructions: "Position: Mains propres\n\n1. Placez vos annulaires sous les yeux\n2. Tapotez d√©licatement du coin interne vers l'externe\n3. Remontez sur la paupi√®re sup√©rieure\n4. R√©p√©tez 10 fois par ≈ìil\n\nBienfaits: Active la circulation, r√©duit les poches"
    },
    {
      name: "Pincements doux des joues",
      instructions: "Position: Devant le miroir\n\n1. Pincez d√©licatement vos joues avec le pouce et l'index\n2. Commencez pr√®s du nez, remontez vers les tempes\n3. Effectuez de petits pincements rythm√©s\n4. Couvrez toute la surface des joues\n\nBienfaits: Stimule la production de collag√®ne, rosit les joues"
    }
  ];

  const skinCareRoutine = {
    matin: [
      { name: "Eau micellaire", instructions: "Imbibez un coton d'eau micellaire et passez d√©licatement sur tout le visage. N'oubliez pas le cou ! Cela √©vite l'utilisation de l'eau calcaire." },
      { name: "Lotion hydratante", instructions: "Appliquez la lotion sur coton ou directement avec les mains, en tapotant d√©licatement. Laissez p√©n√©trer 1 minute." },
      { name: "S√©rum vitamine C", instructions: "3 gouttes suffisent ! R√©partissez sur visage et cou en tapotant. Attendez 2-3 minutes avant la cr√®me." },
      { name: "Cr√®me + SPF 30", instructions: "Appliquez g√©n√©reusement votre cr√®me avec SPF. N'oubliez pas le cou et le d√©collet√© !" }
    ],
    soir: [
      { name: "D√©maquillage huile", instructions: "Massez l'huile de jojoba sur peau s√®che, m√™me sur les yeux. √âmulsifiez avec un peu d'eau puis rincez." },
      { name: "Nettoyage", instructions: "Utilisez votre nettoyant habituel pour √©liminer les r√©sidus d'huile et purifier la peau." },
      { name: "Eau thermale", instructions: "Vaporisez √† 20cm du visage et tapotez avec un mouchoir. Cela neutralise le calcaire de l'eau du robinet." },
      { name: "S√©rum acide hyaluronique", instructions: "Sur peau encore humide ! 2-3 gouttes en tapotant d√©licatement. L'humidit√© aide la p√©n√©tration." },
      { name: "Masque Clarins", instructions: "Continuez votre masque Clarins, il est parfait ! Appliquez en couche √©paisse, laissez poser selon les instructions." }
    ]
  };

  const handleTaskComplete = (taskId) => {
    setCompletedTasks(prev => ({
      ...prev,
      [taskId]: !prev[taskId]
    }));
    if (!completedTasks[taskId]) {
      setPoints(prev => prev + 10);
    } else {
      setPoints(prev => Math.max(0, prev - 10));
    }
  };

  const addWater = (amount) => {
    setWaterIntake(prev => Math.min(waterTarget, prev + amount));
    if (waterIntake + amount >= waterTarget && waterIntake < waterTarget) {
      setPoints(prev => prev + 50);
    }
  };

  const WeightCard = () => (
    <div className="bg-gradient-to-br from-[#B58AFD] via-[#FFA4D3] to-[#FFD785] p-6 rounded-3xl text-white shadow-xl">
      <div className="flex justify-between items-start mb-4">
        <div>
          <h3 className="text-lg font-semibold opacity-90">Perte de Poids</h3>
          <p className="text-sm opacity-75">Objectif No√´l</p>
        </div>
        <Scale className="w-6 h-6 opacity-80" />
      </div>
      
      <div className="text-center mb-6">
        <div className="text-4xl font-bold mb-2">{currentWeight}kg</div>
        <div className="text-sm opacity-75">-{weightLost}kg perdus ‚Ä¢ {weightToLose}kg restants</div>
      </div>

      <div className="mb-4">
        <div className="flex justify-between text-sm mb-2">
          <span>Progression</span>
          <span>{Math.round(progressPercentage)}%</span>
        </div>
        <div className="w-full bg-white/30 rounded-full h-3">
          <div 
            className="bg-white rounded-full h-3 transition-all duration-500"
            style={{ width: `${Math.min(100, progressPercentage)}%` }}
          ></div>
        </div>
      </div>

      <input
        type="number"
        value={currentWeight}
        onChange={(e) => setCurrentWeight(parseFloat(e.target.value) || 98)}
        className="w-full p-2 rounded-xl bg-white/20 text-white placeholder-white/70 text-center"
        placeholder="Poids actuel"
      />
    </div>
  );

  const HydrationCard = () => (
    <div className="bg-gradient-to-br from-[#B58AFD] to-[#FFA4D3] p-6 rounded-3xl text-white shadow-xl">
      <div className="flex justify-between items-center mb-4">
        <h3 className="text-lg font-semibold">Hydratation</h3>
        <Droplets className="w-6 h-6" />
      </div>
      
      <div className="text-center mb-4">
        <div className="text-3xl font-bold">{waterIntake}ml</div>
        <div className="text-sm opacity-75">/ {waterTarget}ml</div>
      </div>

      <div className="mb-4">
        <div className="w-full bg-white/30 rounded-full h-3">
          <div 
            className="bg-white rounded-full h-3 transition-all duration-500"
            style={{ width: `${(waterIntake / waterTarget) * 100}%` }}
          ></div>
        </div>
      </div>

      <div className="flex gap-2">
        <button 
          onClick={() => addWater(250)}
          className="flex-1 bg-white/20 p-2 rounded-xl text-sm hover:bg-white/30 transition-all"
        >+250ml</button>
        <button 
          onClick={() => addWater(500)}
          className="flex-1 bg-white/20 p-2 rounded-xl text-sm hover:bg-white/30 transition-all"
        >+500ml</button>
      </div>
    </div>
  );

  const MoodTracker = () => (
    <div className="bg-gradient-to-br from-[#FFA4D3] to-[#FFD785] p-6 rounded-3xl text-white shadow-xl">
      <div className="flex justify-between items-center mb-4">
        <h3 className="text-lg font-semibold">Humeur</h3>
        <Smile className="w-6 h-6" />
      </div>
      
      <div className="space-y-4">
        <div>
          <p className="text-sm mb-2">Matin</p>
          <div className="flex gap-2">
            {['üò¢', 'üòï', 'üòê', 'üòä', 'üòç'].map((emoji, index) => (
              <button
                key={index}
                onClick={() => setMoodMorning(index)}
                className={`w-10 h-10 rounded-full flex items-center justify-center text-lg transition-all
                  ${moodMorning === index ? 'bg-white/40' : 'bg-white/20 hover:bg-white/30'}`}
              >
                {emoji}
              </button>
            ))}
          </div>
        </div>
        
        <div>
          <p className="text-sm mb-2">Soir</p>
          <div className="flex gap-2">
            {['üò¢', 'üòï', 'üòê', 'üòä', 'üòç'].map((emoji, index) => (
              <button
                key={index}
                onClick={() => setMoodEvening(index)}
                className={`w-10 h-10 rounded-full flex items-center justify-center text-lg transition-all
                  ${moodEvening === index ? 'bg-white/40' : 'bg-white/20 hover:bg-white/30'}`}
              >
                {emoji}
              </button>
            ))}
          </div>
        </div>
      </div>
    </div>
  );

  const TaskList = ({ title, tasks, icon: Icon, color }) => (
    <div className={`bg-gradient-to-br ${color} p-4 rounded-2xl text-white shadow-lg`}>
      <div className="flex items-center gap-2 mb-3">
        <Icon className="w-5 h-5" />
        <h4 className="font-semibold">{title}</h4>
      </div>
      
      <div className="space-y-2">
        {tasks.map((task, index) => (
          <div key={index} className="flex items-center gap-2">
            <label className="flex items-center gap-2 cursor-pointer flex-1">
              <input
                type="checkbox"
                checked={completedTasks[`${title}-${index}`] || false}
                onChange={() => handleTaskComplete(`${title}-${index}`)}
                className="w-4 h-4 rounded accent-white"
              />
              <span className="text-sm">{typeof task === 'string' ? task : task.name}</span>
            </label>
            {typeof task === 'object' && task.instructions && (
              <button
                onClick={() => setSelectedExercise(task)}
                className="bg-white/20 hover:bg-white/30 px-3 py-1 rounded-lg text-xs transition-all font-semibold"
              >
                üëÅÔ∏è
              </button>
            )}
          </div>
        ))}
      </div>
    </div>
  );

  const MenuCard = () => {
    const [todayMenus] = useState(() => ({
      'petit-dejeuner': menus['petit-dejeuner'][Math.floor(Math.random() * menus['petit-dejeuner'].length)],
      'dejeuner': menus['dejeuner'][Math.floor(Math.random() * menus['dejeuner'].length)],
      'diner': menus['diner'][Math.floor(Math.random() * menus['diner'].length)]
    }));

    return (
      <div className="bg-gradient-to-br from-[#B58AFD] to-[#FFD785] p-6 rounded-3xl text-white shadow-xl">
        <div className="flex justify-between items-center mb-4">
          <h3 className="text-lg font-semibold">Menus du Jour</h3>
          <UtensilsCrossed className="w-6 h-6" />
        </div>
        
        <div className="space-y-3">
          {Object.entries(todayMenus).map(([meal, menuItem]) => (
            <button
              key={meal}
              onClick={() => setSelectedRecipe(menuItem)}
              className="w-full bg-white/20 p-3 rounded-xl hover:bg-white/30 transition-all text-left"
            >
              <h4 className="font-medium mb-1 capitalize">{meal.replace('-', ' ')}</h4>
              <p className="text-sm opacity-90">{menuItem.name}</p>
              <p className="text-xs opacity-75 mt-1">üëÜ Cliquez pour la recette</p>
            </button>
          ))}
        </div>
      </div>
    );
  };

  const renderDashboard = () => (
    <div className="p-6 space-y-6">
      <div className="text-center mb-6">
        <h1 className="text-2xl font-bold text-gray-800 mb-2">Bonjour ! ‚ú®</h1>
        <div className="flex items-center justify-center gap-4 text-sm">
          <div className="flex items-center gap-1">
            <Trophy className="w-4 h-4 text-[#FFD785]" />
            <span className="font-semibold">{points} points</span>
          </div>
          <div className="flex items-center gap-1">
            <Target className="w-4 h-4 text-[#B58AFD]" />
            <span>{Math.round(progressPercentage)}% objectif</span>
          </div>
        </div>
      </div>

      <div className="bg-gradient-to-r from-[#FFD785]/20 to-[#FFA4D3]/20 p-4 rounded-2xl mb-4">
        <div className="flex items-start gap-3">
          <Star className="w-5 h-5 text-[#FFD785] mt-0.5" />
          <div>
            <h3 className="font-semibold text-gray-800 mb-1">Conseil du jour</h3>
            <p className="text-sm text-gray-700">{todayTip}</p>
          </div>
        </div>
      </div>

      <div className="bg-gradient-to-r from-[#FFA4D3]/20 to-[#B58AFD]/20 p-4 rounded-2xl mb-6">
        <div className="flex items-start gap-3">
          <Heart className="w-5 h-5 text-[#FFA4D3] mt-0.5" />
          <div>
            <h3 className="font-semibold text-gray-800 mb-1">Motivation</h3>
            <p className="text-sm text-gray-700">{todayMotivation}</p>
          </div>
        </div>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <WeightCard />
        <HydrationCard />
        <MoodTracker />
        <MenuCard />
      </div>
    </div>
  );

  const renderWellness = () => (
    <div className="p-6 space-y-4">
      <h2 className="text-xl font-bold text-gray-800 mb-4">Bien-√™tre</h2>
      
      <TaskList 
        title="Yoga du Visage"
        tasks={faceYogaExercises}
        icon={Sparkles}
        color="from-[#FFA4D3] to-[#FFD785]"
      />
      
      <TaskList 
        title="Yoga Yin"
        tasks={yinYangExercises}
        icon={Flower2}
        color="from-[#B58AFD] to-[#FFA4D3]"
      />
      
      <TaskList 
        title="Compl√©ments"
        tasks={[
          {name: "4 g√©lules collag√®ne", instructions: "Prendre 4 g√©lules de collag√®ne marin le matin √† jeun avec un grand verre d'eau. Id√©alement 30 minutes avant le petit-d√©jeuner pour une meilleure absorption."}, 
          {name: "Probiotiques", instructions: "Prendre 1 g√©lule de probiotiques le soir avant le coucher, avec un peu d'eau. Les probiotiques aident √† maintenir l'√©quilibre de la flore intestinale."}
        ]}
        icon={Pill}
        color="from-[#FFD785] to-[#FFA4D3]"
      />
    </div>
  );

  const renderSkincare = () => (
    <div className="p-6 space-y-4">
      <h2 className="text-xl font-bold text-gray-800 mb-4">Routine Soins</h2>
      
      <TaskList 
        title="Routine Matin"
        tasks={skinCareRoutine.matin}
        icon={Sparkles}
        color="from-[#FFD785] to-[#FFA4D3]"
      />
      
      <TaskList 
        title="Routine Soir"
        tasks={skinCareRoutine.soir}
        icon={Sparkles}
        color="from-[#B58AFD] to-[#FFA4D3]"
      />
    </div>
  );

  const renderJournal = () => (
    <div className="p-6">
      <h2 className="text-xl font-bold text-gray-800 mb-4">Journal de Bord</h2>
      
      <div className="bg-gradient-to-br from-[#B58AFD]/10 to-[#FFA4D3]/10 p-4 rounded-2xl">
        <textarea
          value={journal}
          onChange={(e) => setJournal(e.target.value)}
          placeholder="Exprimez vos pens√©es, vos victoires, vos d√©fis du jour..."
   
